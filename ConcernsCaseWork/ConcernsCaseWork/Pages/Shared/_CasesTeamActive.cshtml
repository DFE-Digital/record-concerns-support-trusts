@using ConcernsCaseWork.Utils.Extensions;
@model IList<ConcernsCaseWork.Models.ActiveCaseSummaryModel>
<table class="govuk-table" id="active-cases" aria-label="Active cases">
    <caption class="govuk-table__caption govuk-table__caption--s dfe-u-font-weight-normal govuk-!-margin-bottom-3">
        Active cases
    </caption>
    <thead class="govuk-table__head">
        <tr class="govuk-table__row tr__large">
            <th class="govuk-table__header govuk-table__cell__cases" scope="col" aria-label="Case identification number">
                Case ID
            </th>
            <th class="govuk-table__header govuk-table__cell__cases govuk-table__header__width_10" scope="col" aria-sort="none">
                Contents
            </th>
            <th class="govuk-table__header govuk-table__cell__cases govuk-table__header__width_10" scope="col" aria-sort="none">
                Trust
            </th>
            <th class="govuk-table__header govuk-table__cell__cases" scope="col" aria-sort="none">
                Managed by
            </th>
            <th class="govuk-table__header govuk-table__cell__cases govuk-table__header--numeric" scope="col" aria-sort="none">
                Last updated
            </th>
            <th class="govuk-table__header govuk-table__cell__cases" scope="col" aria-sort="none">
                Owned by
            </th>
        </tr>
    </thead>
    <tbody class="govuk-table__body">
        @if (Model.Count == 0)
        {
            <tr class="govuk-table__row tr__large">
                <td class="govuk-table__cell__cases govuk-oneline-row" colspan="6" data-testid="no-cases" aria-live="polite">
                    <span>There are no active cases available at this time.</span>
                </td>
            </tr>
        }
        else
        {
            foreach (var activeCase in Model)
            {
                <tr class="govuk-table__row tr__large" data-testid="row-@activeCase.CaseUrn">
                    <td class="govuk-table__cell" data-testid="case-id">
                        <a class="govuk-link" href="/case/@activeCase.CaseUrn/management" aria-label="View case @activeCase.CaseUrn details">@activeCase.CaseUrn</a>
                    </td>
                    @if (!activeCase.ActiveConcerns.Any() && !activeCase.ActiveActionsAndDecisions.Any())
                    {
                        <td class="govuk-table__cell">
                            <span aria-label="No active case content">There are no active concerns, actions or decisions.</span>
                        </td>
                    }

                    @if (!activeCase.ActiveConcerns.Any() && activeCase.ActiveActionsAndDecisions.Any())
                    {
                        <td class="govuk-table__cell">
                            <h4 class="concerns-secondary-text-colour">Actions and decisions</h4>
                            <ul class="govuk-list govuk-list--bullet">
                                @foreach (var action in activeCase.ActiveActionsAndDecisions)
                                {
                                    <li>
                                        @action
                                    </li>
                                }
                            </ul>
                            @if (activeCase.IsMoreActionsAndDecisions)
                            {
                                <span>and more</span>
                            }
                        </td>
                    }

                    @if (activeCase.ActiveConcerns.Any())
                    {
                        <td class="govuk-table__cell">
                            <h4 class="concerns-secondary-text-colour">Concerns</h4>
                            <ul class="govuk-list govuk-list--bullet">
                                @foreach (var concern in activeCase.ActiveConcerns)
                                {
                                    <li data-testid="concern">@concern</li>
                                }
                            </ul>
                            <h4 class="concerns-secondary-text-colour">Risk to trust</h4>
                            <div class="govuk-label-wrapper" data-testid="risk-to-trust-list" aria-label="Trust risk rating">
                                <partial name="_RatingLabel" model="@activeCase.RatingId" />
                            </div>
                        </td>
                    }
                    <td class="govuk-table__cell" data-testid="trust-name">
                        @activeCase.TrustName
                    </td>
                    <td class="govuk-table__cell" data-testid="managed-by">
                        @activeCase.Division?.Description()
                        <br />
                        @activeCase.Area
                    </td>
                    <td class="govuk-table__cell" data-testid="updated-at">
                        @activeCase.CaseLastUpdatedAt
                    </td>
                    <td class="govuk-table__cell" data-testid="created-by">
                        @activeCase.CreatedBy
                    </td>
                </tr>
            }
        }
    </tbody>
</table>