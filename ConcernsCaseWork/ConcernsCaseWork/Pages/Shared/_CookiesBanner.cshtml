@using ConcernsCaseWork.Constants

@{
    var hasMadeDecision = Context.Request.Cookies.ContainsKey(CookieConstants.CookieConsentName);
    var hasMadeHideDecision = Context.Request.Cookies.ContainsKey(CookieConstants.CookieConsentHide);
    // var isCookiesPage = Context.Request.Path.Value?.Contains("/cookies") ?? false;
}

@if (hasMadeDecision) // user has made a decision
{
    var cookieValue = Context.Request.Cookies[CookieConstants.CookieConsentName];

    // Check if the value is "True"
    if (bool.TryParse(cookieValue, out bool hasConsented) && hasConsented && !hasMadeHideDecision) // User has consented
    {
         <form data-testid="cookies-banner-hide-form" asp-page="/Cookies" asp-page-handler="Hide" method="post" id="delete-case-form" novalidate>
            <div class="govuk-cookie-banner"
                 data-nosnippet
                 role="region"
                 aria-label="Hide Cookies on Concerns casework"
                 data-module="govuk-cookie-banner"
                 data-testid="cookies-banner-hide">
                <div class="govuk-cookie-banner__message govuk-extra-width-container">
                    <div class="govuk-grid-row">
                        <div class="govuk-grid-column-two-thirds">
                            <div class="govuk-cookie-banner__content">
                                <p class="govuk-body">You’ve accepted additional cookies. You can <a class="govuk-link" href="/cookies">change your cookie settings</a> at any time.</p>
                            </div>
                        </div>
                    </div>
                    <div class="govuk-button-group">
                        <button type="submit"
                            value="True"
                            data-testid="banner-accept-analytics-cookies-hide-button"
                            class="govuk-button"
                            data-module="govuk-button"
                        >
                            Hide cookie message
                        </button>
                    </div>
                </div>
            </div>
         </form>
    }
}
else // user has not yet made a decision, so we display the banner
{
    <form data-testid="cookies-banner-form" asp-page="/Cookies" method="post">
        <div class="govuk-cookie-banner"
             data-nosnippet
             role="region"
             aria-label="Cookies on Concerns casework"
             data-module="govuk-cookie-banner"
             data-testid="cookies-banner">
            <div class="govuk-cookie-banner__message govuk-extra-width-container">
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-two-thirds">
                        <h2 class="govuk-cookie-banner__heading govuk-heading-m">Cookies on Concerns casework</h2>
                        <div class="govuk-cookie-banner__content">
                            <p class="govuk-body">We use some essential cookies to make this service work.</p>
                            <p class="govuk-body">We’d also like to use analytics cookies so we can understand how you use the service and make improvements.</p>
                        </div>
                    </div>
                </div>
                <div class="govuk-button-group">
                    <button type="submit"
                            value="True"
                            data-testid="banner-accept-analytics-cookies-button"
                            name="bannerConsent"
                            class="govuk-button"
                            data-module="govuk-button">
                        Accept analytics cookies
                    </button>
                    <button type="submit"
                            value="False"
                            data-testid="banner-reject-analytics-cookies-button"
                            name="bannerConsent"
                            class="govuk-button"
                            data-module="govuk-button">
                        Reject analytics cookies
                    </button>
                    <a class="govuk-link" href="/cookies" data-testid="view-cookies-link">View cookies</a>
                </div>
            </div>
        </div>
    </form>
}